{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/GMMF/gmmf_donut_nextjs/lib/symbols.ts"],"sourcesContent":["// /lib/symbols.ts\r\n// Maps between internal asset names and Yahoo Finance symbols.\r\n\r\nexport function mapAssetToSymbol(asset?: string): string | null {\r\n  if (!asset) return null;\r\n  const a = asset.toUpperCase();\r\n\r\n  const mapping: Record<string, string> = {\r\n    // ---- Legacy assets ----\r\n    GOLD: \"GC=F\",\r\n    SILVER: \"SI=F\",\r\n    OIL: \"CL=F\",\r\n    SPY: \"SPY\",\r\n    NASDAQ: \"^IXIC\",\r\n    US10Y: \"^TNX\",\r\n    DXY: \"DX-Y.NYB\",\r\n    EURUSD: \"EURUSD=X\",\r\n    JPYUSD: \"JPYUSD=X\",\r\n    AAPL: \"AAPL\",\r\n    TSLA: \"TSLA\",\r\n    NVDA: \"NVDA\",\r\n\r\n    // ---- Emerging / Crypto ----\r\n    BTC: \"BTC-USD\",\r\n    ETH: \"ETH-USD\",\r\n    SOL: \"SOL-USD\",\r\n    ADA: \"ADA-USD\",\r\n    AVAX: \"AVAX-USD\",\r\n    BNB: \"BNB-USD\",\r\n    XRP: \"XRP-USD\",\r\n    DOGE: \"DOGE-USD\",\r\n    LTC: \"LTC-USD\",\r\n    DOT: \"DOT-USD\",\r\n    MATIC: \"MATIC-USD\",\r\n    LINK: \"LINK-USD\",\r\n    ATOM: \"ATOM-USD\",\r\n    ARB: \"ARB-USD\",\r\n    OP: \"OP-USD\",\r\n    APT: \"APT-USD\",\r\n    NEAR: \"NEAR-USD\",\r\n  };\r\n\r\n  return mapping[a] || null;\r\n}\r\n\r\n/**\r\n * Reverse lookup â€” converts a Yahoo symbol (like \"GC=F\" or \"BTC-USD\")\r\n * back to the internal app name (like \"GOLD\" or \"BTC\").\r\n */\r\nexport function symbolToAsset(symbol?: string): string | null {\r\n  if (!symbol) return null;\r\n  const s = symbol.toUpperCase();\r\n\r\n  const mapping: Record<string, string> = {\r\n    // Legacy\r\n    \"GC=F\": \"GOLD\",\r\n    \"SI=F\": \"SILVER\",\r\n    \"CL=F\": \"OIL\",\r\n    \"SPY\": \"SPY\",\r\n    \"^IXIC\": \"NASDAQ\",\r\n    \"^TNX\": \"US10Y\",\r\n    \"DX-Y.NYB\": \"DXY\",\r\n    \"EURUSD=X\": \"EURUSD\",\r\n    \"JPYUSD=X\": \"JPYUSD\",\r\n    \"AAPL\": \"AAPL\",\r\n    \"TSLA\": \"TSLA\",\r\n    \"NVDA\": \"NVDA\",\r\n\r\n    // Crypto\r\n    \"BTC-USD\": \"BTC\",\r\n    \"ETH-USD\": \"ETH\",\r\n    \"SOL-USD\": \"SOL\",\r\n    \"ADA-USD\": \"ADA\",\r\n    \"AVAX-USD\": \"AVAX\",\r\n    \"BNB-USD\": \"BNB\",\r\n    \"XRP-USD\": \"XRP\",\r\n    \"DOGE-USD\": \"DOGE\",\r\n    \"LTC-USD\": \"LTC\",\r\n    \"DOT-USD\": \"DOT\",\r\n    \"MATIC-USD\": \"MATIC\",\r\n    \"LINK-USD\": \"LINK\",\r\n    \"ATOM-USD\": \"ATOM\",\r\n    \"ARB-USD\": \"ARB\",\r\n    \"OP-USD\": \"OP\",\r\n    \"APT-USD\": \"APT\",\r\n    \"NEAR-USD\": \"NEAR\",\r\n  };\r\n\r\n  return mapping[s] || null;\r\n}\r\n"],"names":[],"mappings":"AAAA,kBAAkB;AAClB,+DAA+D;;;;;;;AAExD,SAAS,iBAAiB,KAAc;IAC7C,IAAI,CAAC,OAAO,OAAO;IACnB,MAAM,IAAI,MAAM,WAAW;IAE3B,MAAM,UAAkC;QACtC,0BAA0B;QAC1B,MAAM;QACN,QAAQ;QACR,KAAK;QACL,KAAK;QACL,QAAQ;QACR,OAAO;QACP,KAAK;QACL,QAAQ;QACR,QAAQ;QACR,MAAM;QACN,MAAM;QACN,MAAM;QAEN,8BAA8B;QAC9B,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,MAAM;QACN,KAAK;QACL,KAAK;QACL,MAAM;QACN,KAAK;QACL,KAAK;QACL,OAAO;QACP,MAAM;QACN,MAAM;QACN,KAAK;QACL,IAAI;QACJ,KAAK;QACL,MAAM;IACR;IAEA,OAAO,OAAO,CAAC,EAAE,IAAI;AACvB;AAMO,SAAS,cAAc,MAAe;IAC3C,IAAI,CAAC,QAAQ,OAAO;IACpB,MAAM,IAAI,OAAO,WAAW;IAE5B,MAAM,UAAkC;QACtC,SAAS;QACT,QAAQ;QACR,QAAQ;QACR,QAAQ;QACR,OAAO;QACP,SAAS;QACT,QAAQ;QACR,YAAY;QACZ,YAAY;QACZ,YAAY;QACZ,QAAQ;QACR,QAAQ;QACR,QAAQ;QAER,SAAS;QACT,WAAW;QACX,WAAW;QACX,WAAW;QACX,WAAW;QACX,YAAY;QACZ,WAAW;QACX,WAAW;QACX,YAAY;QACZ,WAAW;QACX,WAAW;QACX,aAAa;QACb,YAAY;QACZ,YAAY;QACZ,WAAW;QACX,UAAU;QACV,WAAW;QACX,YAAY;IACd;IAEA,OAAO,OAAO,CAAC,EAAE,IAAI;AACvB","debugId":null}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///C:/GMMF/gmmf_donut_nextjs/lib/cache.ts"],"sourcesContent":["// /lib/cache.ts\r\nimport { promises as fs } from \"fs\";\r\nimport path from \"path\";\r\nimport crypto from \"crypto\";\r\n\r\nconst ROOT = path.join(process.cwd(), \".next\", \"cache\", \"gmmf\");\r\nasync function ensureDir(dir: string) { await fs.mkdir(dir, { recursive: true }).catch(() => {}); }\r\n\r\nfunction keyToPath(key: string) {\r\n  const h = crypto.createHash(\"sha1\").update(key).digest(\"hex\");\r\n  return path.join(ROOT, h + \".json\");\r\n}\r\n\r\nexport type Cached<T> = { savedAt: number; ttl: number; payload: T };\r\n\r\n/** Read JSON cache; returns null if missing or expired. */\r\nexport async function readCache<T = any>(key: string): Promise<T | null> {\r\n  try {\r\n    const file = keyToPath(key);\r\n    const raw = await fs.readFile(file, \"utf8\");\r\n    const obj = JSON.parse(raw) as Cached<T>;\r\n    if (!obj?.savedAt || !obj?.ttl) return null;\r\n    const age = (Date.now() - obj.savedAt) / 1000;\r\n    if (age > obj.ttl) return null;\r\n    return obj.payload;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Write JSON cache with TTL seconds. */\r\nexport async function writeCache<T = any>(key: string, payload: T, ttlSeconds: number): Promise<void> {\r\n  try {\r\n    await ensureDir(ROOT);\r\n    const file = keyToPath(key);\r\n    const obj: Cached<T> = { savedAt: Date.now(), ttl: ttlSeconds, payload };\r\n    await fs.writeFile(file, JSON.stringify(obj), \"utf8\");\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\n/** Fetch JSON with cache */\r\nexport async function fetchJSONWithCache<T = any>(url: string, ttlSeconds: number, init?: RequestInit): Promise<T> {\r\n  const key = `json:${url}`;\r\n  const cached = await readCache<T>(key);\r\n  if (cached) return cached;\r\n  const r = await fetch(url, { ...(init || {}), cache: \"no-store\" });\r\n  if (!r.ok) throw new Error(`HTTP ${r.status} for ${url}`);\r\n  const data = (await r.json()) as T;\r\n  await writeCache(key, data, ttlSeconds);\r\n  return data;\r\n}\r\n\r\n/** Fetch text with cache */\r\nexport async function fetchTextWithCache(url: string, ttlSeconds: number, init?: RequestInit): Promise<string> {\r\n  const key = `text:${url}`;\r\n  const cached = await readCache<string>(key);\r\n  if (cached) return cached;\r\n  const r = await fetch(url, { ...(init || {}), cache: \"no-store\" });\r\n  if (!r.ok) throw new Error(`HTTP ${r.status} for ${url}`);\r\n  const data = await r.text();\r\n  await writeCache(key, data, ttlSeconds);\r\n  return data;\r\n}\r\n"],"names":[],"mappings":"AAAA,gBAAgB;;;;;;;;;;;AAChB;AACA;AACA;;;;AAEA,MAAM,OAAO,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,SAAS,SAAS;AACxD,eAAe,UAAU,GAAW;IAAI,MAAM,yGAAE,CAAC,KAAK,CAAC,KAAK;QAAE,WAAW;IAAK,GAAG,KAAK,CAAC,KAAO;AAAI;AAElG,SAAS,UAAU,GAAW;IAC5B,MAAM,IAAI,gHAAM,CAAC,UAAU,CAAC,QAAQ,MAAM,CAAC,KAAK,MAAM,CAAC;IACvD,OAAO,4GAAI,CAAC,IAAI,CAAC,MAAM,IAAI;AAC7B;AAKO,eAAe,UAAmB,GAAW;IAClD,IAAI;QACF,MAAM,OAAO,UAAU;QACvB,MAAM,MAAM,MAAM,yGAAE,CAAC,QAAQ,CAAC,MAAM;QACpC,MAAM,MAAM,KAAK,KAAK,CAAC;QACvB,IAAI,CAAC,KAAK,WAAW,CAAC,KAAK,KAAK,OAAO;QACvC,MAAM,MAAM,CAAC,KAAK,GAAG,KAAK,IAAI,OAAO,IAAI;QACzC,IAAI,MAAM,IAAI,GAAG,EAAE,OAAO;QAC1B,OAAO,IAAI,OAAO;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAGO,eAAe,WAAoB,GAAW,EAAE,OAAU,EAAE,UAAkB;IACnF,IAAI;QACF,MAAM,UAAU;QAChB,MAAM,OAAO,UAAU;QACvB,MAAM,MAAiB;YAAE,SAAS,KAAK,GAAG;YAAI,KAAK;YAAY;QAAQ;QACvE,MAAM,yGAAE,CAAC,SAAS,CAAC,MAAM,KAAK,SAAS,CAAC,MAAM;IAChD,EAAE,OAAM;IACN,SAAS;IACX;AACF;AAGO,eAAe,mBAA4B,GAAW,EAAE,UAAkB,EAAE,IAAkB;IACnG,MAAM,MAAM,CAAC,KAAK,EAAE,KAAK;IACzB,MAAM,SAAS,MAAM,UAAa;IAClC,IAAI,QAAQ,OAAO;IACnB,MAAM,IAAI,MAAM,MAAM,KAAK;QAAE,GAAI,QAAQ,CAAC,CAAC;QAAG,OAAO;IAAW;IAChE,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,EAAE,MAAM,CAAC,KAAK,EAAE,KAAK;IACxD,MAAM,OAAQ,MAAM,EAAE,IAAI;IAC1B,MAAM,WAAW,KAAK,MAAM;IAC5B,OAAO;AACT;AAGO,eAAe,mBAAmB,GAAW,EAAE,UAAkB,EAAE,IAAkB;IAC1F,MAAM,MAAM,CAAC,KAAK,EAAE,KAAK;IACzB,MAAM,SAAS,MAAM,UAAkB;IACvC,IAAI,QAAQ,OAAO;IACnB,MAAM,IAAI,MAAM,MAAM,KAAK;QAAE,GAAI,QAAQ,CAAC,CAAC;QAAG,OAAO;IAAW;IAChE,IAAI,CAAC,EAAE,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,EAAE,MAAM,CAAC,KAAK,EAAE,KAAK;IACxD,MAAM,OAAO,MAAM,EAAE,IAAI;IACzB,MAAM,WAAW,KAAK,MAAM;IAC5B,OAAO;AACT","debugId":null}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///C:/GMMF/gmmf_donut_nextjs/pages/api/series.ts"],"sourcesContent":["// /pages/api/series.ts\r\nimport type { NextApiRequest, NextApiResponse } from \"next\";\r\nimport { mapAssetToSymbol } from \"@/lib/symbols\";\r\nimport { readCache, writeCache } from \"@/lib/cache\";\r\n\r\ntype SeriesPoint = { date: string; close: number };\r\ntype SeriesPayload = {\r\n  symbol: string;\r\n  asset?: string;\r\n  lastClose: number | null;\r\n  series: SeriesPoint[];\r\n  source: \"yahoo-finance2\" | \"synthetic\" | \"cache\";\r\n};\r\n\r\nconst TTL_SECONDS = 15 * 60; // 15 min\r\n\r\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\r\n  const asset = String(req.query.asset || \"\").toUpperCase();\r\n  const qSym = String(req.query.symbol || \"\").toUpperCase();\r\n  const symbol = qSym || mapAssetToSymbol(asset) || \"SPY\";\r\n\r\n  const cacheKey = `yf:${symbol}`;\r\n  const cached = await readCache<SeriesPayload>(cacheKey);\r\n  if (cached) {\r\n    res.status(200).json({ ...cached, source: \"cache\" as const });\r\n    return;\r\n  }\r\n\r\n  // Try yahoo-finance2 (ESM)\r\n  try {\r\n    const mod = (await import(\"yahoo-finance2\").catch(() => null)) as any;\r\n    const yf = mod?.default;\r\n    if (yf) {\r\n      const to = new Date();\r\n      const from = new Date(to.getTime() - 365 * 24 * 3600 * 1000);\r\n      const rows = await yf.historical(symbol, {\r\n        period1: from.toISOString().slice(0, 10),\r\n        period2: to.toISOString().slice(0, 10),\r\n      });\r\n\r\n      const series: SeriesPoint[] = (rows || [])\r\n        .filter((r: any) => r?.date && Number.isFinite(r?.close))\r\n        .map((r: any) => ({\r\n          date: new Date(r.date).toISOString().slice(0, 10),\r\n          close: Number(r.close),\r\n        }));\r\n\r\n      const payload: SeriesPayload = {\r\n        symbol,\r\n        asset: asset || undefined,\r\n        lastClose: series.length ? series[series.length - 1].close : null,\r\n        series,\r\n        source: \"yahoo-finance2\",\r\n      };\r\n      await writeCache(cacheKey, payload, TTL_SECONDS);\r\n      res.status(200).json(payload);\r\n      return;\r\n    }\r\n  } catch {\r\n    // fall through\r\n  }\r\n\r\n  // Synthetic fallback\r\n  const series: SeriesPoint[] = [];\r\n  const today = new Date();\r\n  let base = 100;\r\n  for (let i = 180; i >= 0; i--) {\r\n    const d = new Date(today.getTime() - i * 24 * 3600 * 1000);\r\n    if (d.getDay() !== 0 && d.getDay() !== 6) {\r\n      base *= 1 + (Math.random() - 0.5) * 0.01 + Math.sin(i / 12) * 0.001;\r\n      series.push({ date: d.toISOString().slice(0, 10), close: Number(base.toFixed(2)) });\r\n    }\r\n  }\r\n  const payload: SeriesPayload = {\r\n    symbol,\r\n    asset: asset || undefined,\r\n    lastClose: series.length ? series[series.length - 1].close : null,\r\n    series,\r\n    source: \"synthetic\",\r\n  };\r\n  await writeCache(cacheKey, payload, TTL_SECONDS);\r\n  res.status(200).json(payload);\r\n}\r\n"],"names":[],"mappings":"AAAA,uBAAuB;;;;;AAEvB;AACA;;;AAWA,MAAM,cAAc,KAAK,IAAI,SAAS;AAEvB,eAAe,QAAQ,GAAmB,EAAE,GAAoB;IAC7E,MAAM,QAAQ,OAAO,IAAI,KAAK,CAAC,KAAK,IAAI,IAAI,WAAW;IACvD,MAAM,OAAO,OAAO,IAAI,KAAK,CAAC,MAAM,IAAI,IAAI,WAAW;IACvD,MAAM,SAAS,QAAQ,IAAA,2HAAgB,EAAC,UAAU;IAElD,MAAM,WAAW,CAAC,GAAG,EAAE,QAAQ;IAC/B,MAAM,SAAS,MAAM,IAAA,kHAAS,EAAgB;IAC9C,IAAI,QAAQ;QACV,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,GAAG,MAAM;YAAE,QAAQ;QAAiB;QAC3D;IACF;IAEA,2BAA2B;IAC3B,IAAI;QACF,MAAM,MAAO,MAAM,4GAAyB,KAAK,CAAC,IAAM;QACxD,MAAM,KAAK,KAAK;QAChB,IAAI,IAAI;YACN,MAAM,KAAK,IAAI;YACf,MAAM,OAAO,IAAI,KAAK,GAAG,OAAO,KAAK,MAAM,KAAK,OAAO;YACvD,MAAM,OAAO,MAAM,GAAG,UAAU,CAAC,QAAQ;gBACvC,SAAS,KAAK,WAAW,GAAG,KAAK,CAAC,GAAG;gBACrC,SAAS,GAAG,WAAW,GAAG,KAAK,CAAC,GAAG;YACrC;YAEA,MAAM,SAAwB,CAAC,QAAQ,EAAE,EACtC,MAAM,CAAC,CAAC,IAAW,GAAG,QAAQ,OAAO,QAAQ,CAAC,GAAG,QACjD,GAAG,CAAC,CAAC,IAAW,CAAC;oBAChB,MAAM,IAAI,KAAK,EAAE,IAAI,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG;oBAC9C,OAAO,OAAO,EAAE,KAAK;gBACvB,CAAC;YAEH,MAAM,UAAyB;gBAC7B;gBACA,OAAO,SAAS;gBAChB,WAAW,OAAO,MAAM,GAAG,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,KAAK,GAAG;gBAC7D;gBACA,QAAQ;YACV;YACA,MAAM,IAAA,mHAAU,EAAC,UAAU,SAAS;YACpC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACrB;QACF;IACF,EAAE,OAAM;IACN,eAAe;IACjB;IAEA,qBAAqB;IACrB,MAAM,SAAwB,EAAE;IAChC,MAAM,QAAQ,IAAI;IAClB,IAAI,OAAO;IACX,IAAK,IAAI,IAAI,KAAK,KAAK,GAAG,IAAK;QAC7B,MAAM,IAAI,IAAI,KAAK,MAAM,OAAO,KAAK,IAAI,KAAK,OAAO;QACrD,IAAI,EAAE,MAAM,OAAO,KAAK,EAAE,MAAM,OAAO,GAAG;YACxC,QAAQ,IAAI,CAAC,KAAK,MAAM,KAAK,GAAG,IAAI,OAAO,KAAK,GAAG,CAAC,IAAI,MAAM;YAC9D,OAAO,IAAI,CAAC;gBAAE,MAAM,EAAE,WAAW,GAAG,KAAK,CAAC,GAAG;gBAAK,OAAO,OAAO,KAAK,OAAO,CAAC;YAAI;QACnF;IACF;IACA,MAAM,UAAyB;QAC7B;QACA,OAAO,SAAS;QAChB,WAAW,OAAO,MAAM,GAAG,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,KAAK,GAAG;QAC7D;QACA,QAAQ;IACV;IACA,MAAM,IAAA,mHAAU,EAAC,UAAU,SAAS;IACpC,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;AACvB","debugId":null}}]
}